(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[186],{730:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>n});var t=l(5155),s=l(2115);let r="localhost"===window.location.hostname?"http://localhost:8080":"https://artemanha-backend.onrender.com";function n(){var e,a,l,n,i,o,c,d,u,m;let[x,h]=(0,s.useState)([]),[b,p]=(0,s.useState)([]),[v,j]=(0,s.useState)([]),[g,f]=(0,s.useState)([]),[N,w]=(0,s.useState)(!1),[y,C]=(0,s.useState)(!1),[k,S]=(0,s.useState)(null),[M,E]=(0,s.useState)(null),[T,D]=(0,s.useState)(null),[A,L]=(0,s.useState)(!1),[I,F]=(0,s.useState)({aluno:"",turma:"",situacao:""}),_=e=>{let a=e.replace(/\D/g,"");return(a.length>8&&(a=a.slice(0,8)),a.length>=5)?"".concat(a.slice(0,2),"/").concat(a.slice(2,4),"/").concat(a.slice(4)):a.length>=3?"".concat(a.slice(0,2),"/").concat(a.slice(2)):a},O=e=>{if(!e)return;let a=/^(\d{2})\/(\d{2})\/(\d{4})$/.exec(e);if(!a)return;let[,l,t,s]=a;return"".concat(s,"-").concat(t,"-").concat(l)},P=e=>{if(!e)return"";if(e.includes("/"))return e;let a=e.split("-");if(3!==a.length)return e;let[l,t,s]=a;return"".concat(s,"/").concat(t,"/").concat(l)},z=e=>{if(!e)return!1;let a=/^(\d{2})\/(\d{2})\/(\d{4})$/.exec(e);if(!a)return!1;let[,l,t,s]=a,r=new Date(Number(s),Number(t)-1,Number(l));return r.getFullYear()===Number(s)&&r.getMonth()===Number(t)-1&&r.getDate()===Number(l)},B=async e=>{let a=await fetch(e);if(!a.ok)throw Error("HTTP ".concat(a.status," ao buscar ").concat(e));return await a.json()},R=e=>{var a,l,t,s;return{id:e.id,aluno:e.aluno,turma:e.turma,situacao:e.situacao,dataMatricula:P(null!=(a=e.dataMatricula)?a:void 0),inicio:P(null!=(l=e.inicio)?l:void 0),termino:P(null!=(t=e.termino)?t:void 0),observacoes:null!=(s=e.observacoes)?s:""}},V=(0,s.useCallback)(async()=>{h((await B("".concat(r,"/api/matriculas"))).map(R))},[]),$=(0,s.useCallback)(async()=>{try{let[e,a,l,t]=await Promise.all([B("".concat(r,"/api/matriculas")),B("".concat(r,"/api/alunos")),B("".concat(r,"/api/turmas")),B("".concat(r,"/api/matricula-situacoes"))]);h(e.map(R)),p(a),j(l),f(Array.isArray(t)?t:[])}catch(e){console.error("Falha ao carregar dados:",e),f([])}},[]);(0,s.useEffect)(()=>{$().catch(console.error)},[$]);let H=(0,s.useCallback)(e=>[...e].sort((e,a)=>e.nome.localeCompare(a.nome,"pt-BR",{sensitivity:"base"})),[]),J=(0,s.useMemo)(()=>{var e;let a=null==k||null==(e=k.aluno)?void 0:e.id;return H(b.filter(e=>null==e.matricula||null!=a&&e.id===a))},[b,null==k||null==(e=k.aluno)?void 0:e.id,H]),U=(0,s.useMemo)(()=>H(v),[v,H]),Y=(0,s.useMemo)(()=>[...g].sort((e,a)=>e.descricao.localeCompare(a.descricao,"pt-BR",{sensitivity:"base"})),[g]),q=(0,s.useMemo)(()=>{let e=I.aluno.toLowerCase(),a=I.turma.toLowerCase(),l=I.situacao.toLowerCase();return x.filter(t=>{var s,r,n,i,o,c,d,u,m;let x=null!=(d=null==(r=t.aluno)||null==(s=r.nome)?void 0:s.toLowerCase())?d:"",h=null!=(u=null==(i=t.turma)||null==(n=i.nome)?void 0:n.toLowerCase())?u:"",b=null!=(m=null==(c=t.situacao)||null==(o=c.descricao)?void 0:o.toLowerCase())?m:"";return x.includes(e)&&h.includes(a)&&(""===l||b===l)})},[x,I]),G=e=>{e?(S({...e}),C(!1)):(S({aluno:null,turma:null,situacao:g.find(e=>"ativa"===e.descricao.toLowerCase())||null,dataMatricula:"",inicio:"",termino:"",observacoes:""}),C(!0)),D(null),w(!0)},K=async()=>{var e,a,l;if(!k)return;let t=(null==(a=k.aluno)?void 0:a.id)?(null==(l=k.turma)?void 0:l.id)?k.dataMatricula&&z(k.dataMatricula)?k.inicio&&z(k.inicio)?k.termino&&z(k.termino)?null:"Informe uma data de T\xe9rmino v\xe1lida (dd/mm/aaaa).":"Informe uma data de In\xedcio v\xe1lida (dd/mm/aaaa).":"Informe uma Data da matr\xedcula v\xe1lida (dd/mm/aaaa).":"Selecione a turma.":"Selecione o aluno.";if(t)return void D(t);let s={aluno:k.aluno?{id:k.aluno.id}:null,turma:k.turma?{id:k.turma.id}:null,situacao:k.situacao?{id:k.situacao.id}:null,dataMatricula:O(k.dataMatricula),inicio:O(k.inicio),termino:O(k.termino),observacoes:null!=(e=k.observacoes)?e:""},n=k.id?"PUT":"POST",i=k.id?"".concat(r,"/api/matriculas/").concat(k.id):"".concat(r,"/api/matriculas");try{let e=await fetch(i,{method:n,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok){let a=await e.text();console.error("Erro salvar:",e.status,a),409===e.status?D("Aluno j\xe1 possui matr\xedcula ATIVA nesta turma."):422===e.status?D("Turma sem vagas."):D("Erro ao salvar matr\xedcula.");return}E(k.id?"✅ Matr\xedcula atualizada!":"\uD83C\uDF89 Matr\xedcula criada!"),w(!1),await V(),setTimeout(()=>E(null),4e3)}catch(e){console.error(e),D("Erro inesperado ao salvar.")}},Q=async()=>{if(null==k?void 0:k.id)try{if(!(await fetch("".concat(r,"/api/matriculas/").concat(k.id),{method:"DELETE"})).ok)return void D("Erro ao excluir matr\xedcula.");L(!1),w(!1),E("\uD83D\uDDD1️ Matr\xedcula exclu\xedda."),await V(),setTimeout(()=>E(null),4e3)}catch(e){console.error(e),D("Erro inesperado ao excluir.")}};return(0,t.jsxs)("main",{className:"p-10 font-sans min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,t.jsxs)("div",{className:"max-w-7xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden",children:[(0,t.jsxs)("header",{className:"bg-blue-600 text-white p-6 flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold tracking-wide",children:"\uD83D\uDCD1 Matr\xedculas"}),(0,t.jsx)("button",{onClick:()=>G(),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition-all",children:"+ Matricular Aluno"})]}),M&&(0,t.jsx)("div",{className:"text-center bg-green-100 text-green-700 py-2 font-medium",children:M}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 p-4 bg-blue-50 border-b",children:[(0,t.jsx)("input",{placeholder:"Filtrar por aluno",className:"p-2 rounded border",value:I.aluno,onChange:e=>F({...I,aluno:e.target.value})}),(0,t.jsx)("input",{placeholder:"Filtrar por turma",className:"p-2 rounded border",value:I.turma,onChange:e=>F({...I,turma:e.target.value})}),(0,t.jsxs)("select",{className:"p-2 rounded border",value:I.situacao,onChange:e=>F({...I,situacao:e.target.value}),children:[(0,t.jsx)("option",{value:"",children:"Todas as Situa\xe7\xf5es"}),Y.map(e=>(0,t.jsx)("option",{value:e.descricao.toLowerCase(),children:e.descricao},e.id))]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-blue-100 text-blue-800",children:[(0,t.jsx)("th",{className:"p-3 text-left text-sm font-semibold",children:"Id"}),(0,t.jsx)("th",{className:"p-3 text-left text-sm font-semibold",children:"Aluno"}),(0,t.jsx)("th",{className:"p-3 text-left text-sm font-semibold",children:"Turma"}),(0,t.jsx)("th",{className:"p-3 text-left text-sm font-semibold",children:"Situa\xe7\xe3o"}),(0,t.jsx)("th",{className:"p-3 text-left text-sm font-semibold",children:"Data da matr\xedcula"}),(0,t.jsx)("th",{className:"p-3 text-left text-sm font-semibold",children:"In\xedcio"}),(0,t.jsx)("th",{className:"p-3 text-left text-sm font-semibold",children:"T\xe9rmino"}),(0,t.jsx)("th",{className:"p-3 text-center text-sm font-semibold",children:"A\xe7\xf5es"})]})}),(0,t.jsxs)("tbody",{children:[q.map((e,a)=>{var l,s,r;return(0,t.jsxs)("tr",{className:"transition-colors ".concat(a%2==0?"bg-white":"bg-blue-50"," hover:bg-blue-100"),children:[(0,t.jsx)("td",{className:"p-3",children:e.id}),(0,t.jsx)("td",{className:"p-3",children:null==(l=e.aluno)?void 0:l.nome}),(0,t.jsx)("td",{className:"p-3",children:null==(s=e.turma)?void 0:s.nome}),(0,t.jsx)("td",{className:"p-3",children:null==(r=e.situacao)?void 0:r.descricao}),(0,t.jsx)("td",{className:"p-3",children:e.dataMatricula||"—"}),(0,t.jsx)("td",{className:"p-3",children:e.inicio||"—"}),(0,t.jsx)("td",{className:"p-3",children:e.termino||"—"}),(0,t.jsx)("td",{className:"p-3 text-center",children:(0,t.jsx)("button",{onClick:()=>G(e),className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md transition-all",children:"Visualizar"})})]},e.id)}),0===q.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{className:"p-4 text-center text-gray-500",colSpan:8,children:"Nenhuma matr\xedcula encontrada."})})]})]})})]}),N&&k&&(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-200/40 backdrop-blur-sm flex items-center justify-center transition-all duration-300 z-50",children:(0,t.jsxs)("div",{className:"bg-white w-[1000px] rounded-xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto border border-gray-100",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-6 text-blue-700",children:"\uD83E\uDDFE Dados da Matr\xedcula"}),T&&(0,t.jsx)("div",{className:"mb-4 rounded border border-red-300 bg-red-50 text-red-700 p-3 text-sm",children:T}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Aluno"}),(0,t.jsxs)("select",{className:"p-2 border rounded w-full",value:null!=(c=null==(a=k.aluno)?void 0:a.id)?c:"",disabled:!y,onChange:e=>{let a=Number(e.target.value),l=b.find(e=>e.id===a)||null;S({...k,aluno:l})},children:[(0,t.jsx)("option",{value:"",children:"Selecione"}),J.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nome},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Turma"}),(0,t.jsxs)("select",{className:"p-2 border rounded w-full",value:null!=(d=null==(l=k.turma)?void 0:l.id)?d:"",disabled:!y,onChange:e=>{let a=Number(e.target.value),l=v.find(e=>e.id===a)||null;S({...k,turma:l})},children:[(0,t.jsx)("option",{value:"",children:"Selecione"}),U.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nome},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Situa\xe7\xe3o"}),(0,t.jsxs)("select",{className:"p-2 border rounded w-full",value:null!=(u=null==(n=k.situacao)?void 0:n.id)?u:"",disabled:!y,onChange:e=>{let a=Number(e.target.value),l=g.find(e=>e.id===a)||null;S({...k,situacao:l})},children:[(0,t.jsx)("option",{value:"",children:"Selecione"}),Y.map(e=>(0,t.jsx)("option",{value:e.id,children:e.descricao},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Data da matr\xedcula"}),(0,t.jsx)("input",{className:"p-2 border rounded w-full",value:k.dataMatricula||"",disabled:!y,onChange:e=>S({...k,dataMatricula:_(e.target.value)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"In\xedcio"}),(0,t.jsx)("input",{className:"p-2 border rounded w-full",value:k.inicio||"",disabled:!y,onChange:e=>S({...k,inicio:_(e.target.value)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"T\xe9rmino"}),(0,t.jsx)("input",{className:"p-2 border rounded w-full",value:k.termino||"",disabled:!y,onChange:e=>S({...k,termino:_(e.target.value)})})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Observa\xe7\xf5es"}),(0,t.jsx)("textarea",{className:"p-2 border rounded w-full min-h-24",value:null!=(m=k.observacoes)?m:"",disabled:!y,onChange:e=>S({...k,observacoes:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,t.jsx)("div",{className:"flex gap-3",children:y?(0,t.jsx)("button",{onClick:K,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md",children:"Salvar"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>C(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md",children:"Editar"}),k.id&&(0,t.jsx)("button",{onClick:()=>L(!0),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md",children:"Excluir"})]})}),(0,t.jsx)("button",{onClick:()=>w(!1),className:"bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-md",children:"Fechar"})]})]})}),A&&k&&(0,t.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-lg text-center w-96",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Excluir matr\xedcula de ",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"font-bold text-red-600",children:null==(i=k.aluno)?void 0:i.nome})," na turma"," ",(0,t.jsx)("span",{className:"font-bold text-red-600",children:null==(o=k.turma)?void 0:o.nome}),"?"]}),(0,t.jsxs)("div",{className:"flex justify-center gap-4 mt-6",children:[(0,t.jsx)("button",{onClick:Q,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md",children:"Sim, excluir"}),(0,t.jsx)("button",{onClick:()=>L(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md",children:"Cancelar"})]})]})})]})}},6884:(e,a,l)=>{Promise.resolve().then(l.bind(l,730))}},e=>{e.O(0,[441,255,358],()=>e(e.s=6884)),_N_E=e.O()}]);